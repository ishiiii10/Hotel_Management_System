<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BookingEventListener.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">notification-service</a> &gt; <a href="index.source.html" class="el_package">com.hotelbooking.notification.listener</a> &gt; <span class="el_source">BookingEventListener.java</span></div><h1>BookingEventListener.java</h1><pre class="source lang-java linenums">package com.hotelbooking.notification.listener;

import java.util.Map;

import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Component;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import com.hotelbooking.notification.dto.BookingCancelledEvent;
import com.hotelbooking.notification.dto.BookingConfirmedEvent;
import com.hotelbooking.notification.dto.BookingCreatedEvent;
import com.hotelbooking.notification.dto.CheckoutCompletedEvent;
import com.hotelbooking.notification.dto.GuestCheckedInEvent;
import com.hotelbooking.notification.service.NotificationService;

import lombok.extern.slf4j.Slf4j;

@Component
<span class="fc" id="L21">@Slf4j</span>
public class BookingEventListener {

    private final NotificationService notificationService;
    private final ObjectMapper objectMapper;

<span class="fc" id="L27">    public BookingEventListener(NotificationService notificationService) {</span>
<span class="fc" id="L28">        this.notificationService = notificationService;</span>
<span class="fc" id="L29">        this.objectMapper = new ObjectMapper();</span>
<span class="fc" id="L30">        this.objectMapper.registerModule(new JavaTimeModule());</span>
<span class="fc" id="L31">    }</span>

    @KafkaListener(topics = &quot;booking-created&quot;, groupId = &quot;notification-group&quot;)
    public void handleBookingCreated(ConsumerRecord&lt;String, Object&gt; record) {
        try {
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L37">            Map&lt;String, Object&gt; payload = (Map&lt;String, Object&gt;) record.value();</span>
<span class="nc" id="L38">            log.info(&quot;Received booking-created event: {}&quot;, payload);</span>
<span class="nc" id="L39">            BookingCreatedEvent event = objectMapper.convertValue(payload, BookingCreatedEvent.class);</span>
<span class="nc" id="L40">            notificationService.handleBookingCreated(event);</span>
<span class="nc" id="L41">        } catch (Exception e) {</span>
<span class="nc" id="L42">            log.error(&quot;Error deserializing booking-created event: {}&quot;, record.value(), e);</span>
<span class="nc" id="L43">        }</span>
<span class="nc" id="L44">    }</span>

    @KafkaListener(topics = &quot;booking-confirmed&quot;, groupId = &quot;notification-group&quot;)
    public void handleBookingConfirmed(ConsumerRecord&lt;String, Object&gt; record) {
        try {
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L50">            Map&lt;String, Object&gt; payload = (Map&lt;String, Object&gt;) record.value();</span>
<span class="nc" id="L51">            log.info(&quot;Received booking-confirmed event: {}&quot;, payload);</span>
<span class="nc" id="L52">            BookingConfirmedEvent event = objectMapper.convertValue(payload, BookingConfirmedEvent.class);</span>
<span class="nc" id="L53">            notificationService.handleBookingConfirmed(event);</span>
<span class="nc" id="L54">        } catch (Exception e) {</span>
<span class="nc" id="L55">            log.error(&quot;Error deserializing booking-confirmed event: {}&quot;, record.value(), e);</span>
<span class="nc" id="L56">        }</span>
<span class="nc" id="L57">    }</span>

    @KafkaListener(topics = &quot;booking-cancelled&quot;, groupId = &quot;notification-group&quot;)
    public void handleBookingCancelled(ConsumerRecord&lt;String, Object&gt; record) {
        try {
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L63">            Map&lt;String, Object&gt; payload = (Map&lt;String, Object&gt;) record.value();</span>
<span class="nc" id="L64">            log.info(&quot;Received booking-cancelled event: {}&quot;, payload);</span>
<span class="nc" id="L65">            BookingCancelledEvent event = objectMapper.convertValue(payload, BookingCancelledEvent.class);</span>
<span class="nc" id="L66">            notificationService.handleBookingCancelled(event);</span>
<span class="nc" id="L67">        } catch (Exception e) {</span>
<span class="nc" id="L68">            log.error(&quot;Error deserializing booking-cancelled event: {}&quot;, record.value(), e);</span>
<span class="nc" id="L69">        }</span>
<span class="nc" id="L70">    }</span>

    @KafkaListener(topics = &quot;guest-checked-in&quot;, groupId = &quot;notification-group&quot;)
    public void handleGuestCheckedIn(ConsumerRecord&lt;String, Object&gt; record) {
        try {
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L76">            Map&lt;String, Object&gt; payload = (Map&lt;String, Object&gt;) record.value();</span>
<span class="nc" id="L77">            log.info(&quot;Received guest-checked-in event: {}&quot;, payload);</span>
<span class="nc" id="L78">            GuestCheckedInEvent event = objectMapper.convertValue(payload, GuestCheckedInEvent.class);</span>
<span class="nc" id="L79">            notificationService.handleGuestCheckedIn(event);</span>
<span class="nc" id="L80">        } catch (Exception e) {</span>
<span class="nc" id="L81">            log.error(&quot;Error deserializing guest-checked-in event: {}&quot;, record.value(), e);</span>
<span class="nc" id="L82">        }</span>
<span class="nc" id="L83">    }</span>

    @KafkaListener(topics = &quot;checkout-completed&quot;, groupId = &quot;notification-group&quot;)
    public void handleCheckoutCompleted(ConsumerRecord&lt;String, Object&gt; record) {
        try {
            @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L89">            Map&lt;String, Object&gt; payload = (Map&lt;String, Object&gt;) record.value();</span>
<span class="nc" id="L90">            log.info(&quot;Received checkout-completed event: {}&quot;, payload);</span>
<span class="nc" id="L91">            CheckoutCompletedEvent event = objectMapper.convertValue(payload, CheckoutCompletedEvent.class);</span>
<span class="nc" id="L92">            notificationService.handleCheckoutCompleted(event);</span>
<span class="nc" id="L93">        } catch (Exception e) {</span>
<span class="nc" id="L94">            log.error(&quot;Error deserializing checkout-completed event: {}&quot;, record.value(), e);</span>
<span class="nc" id="L95">        }</span>
<span class="nc" id="L96">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>